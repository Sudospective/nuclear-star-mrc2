<Mods LoadCommand = "%xero(function(self)

	-- To help Kid with porting --
	--------------------------------------------------------
	-- Mods are aliased and auxed for SM in portable.lua. --
	-- FarDistZ is also set and the aux nodes are scaled. --
	--------------------------------------------------------
	if FUCK_EXE then
		songDir = '.'..GAMESTATE:GetCurrentSong():GetSongDir() -- Change this if you're having issues
	else
		songDir = GAMESTATE:GetCurrentSong():GetSongDir()
	end

	-- Sanity Check
	local sanity = loadfile(songDir..'lua/scripts/sanity.lua')
	if sanity == nil then
		SCREENMAN:SystemMessage('Unable to locate song directory (mods.xml:9)')
		return
	end

	-- SM5 Porter - Requires manual coding behavior changes, check portable.lua for instructions.
	if sanity ~= nil then
		xero(loadfile(songDir..'lua/scripts/portable.lua'))()
	end
	
	-- AFT Multiplier
	aftMult = 1
	detectNV = false
	if string.find(string.lower(PREFSMAN:GetPreference('LastSeenVideoDriver')), 'nvidia') or string.find(string.lower(DISPLAY:GetVendor()),'nvidia') then
		Trace('NVidia graphics driver detected.')
		Trace('AFT multiplier set to 0.9.')
		detectNV = true
		aftMult = 0.9
	else
		Trace('No NVidia graphics driver detected.')
		Trace('AFT multiplier is 1.0.')
	end

	-- AFT Frame Limiter
	lastFrameTime = GAMESTATE:GetSongTime()
	deltaTime = GAMESTATE:GetSongTime() - lastFrameTime
	if FUCK_EXE then
		spb = 1 / GAMESTATE:GetCurBPS()
	else
		spb = 1 / GAMESTATE:GetSongPosition():GetCurBPS()
	end

	-- Proxy Setup
	for pn = 1, 2 do
		setupJudgeProxy(PJ[pn], P[pn]:GetChild('Judgment'), pn)
		setupJudgeProxy(PC[pn], P[pn]:GetChild('Combo'), pn)
	end
	for pn = 1, #PP do
		PP[pn]:SetTarget(P[pn])
		P[pn]:hidden(1)
	end

	-- AFT Setup
	aft(AFT)
	sprite(AFTSprite)
	aftsprite(AFT, AFTSprite)

	-- Default Mods
    AFTSprite:diffusealpha(0 * aftMult)
	AFTSprite:zoom(1)
	setdefault {1.5, 'xmod', 0, 'straightholds'}
	func {0, 999, function()
    	deltaTime = deltaTime + GAMESTATE:GetSongTime() - lastFrameTime
    	if deltaTime > 0 then
        	AFT:hidden(0)
        	deltaTime = deltaTime - (1 / 60)
    	else
        	AFT:hidden(1)
    	end
    	lastFrameTime = GAMESTATE:GetSongTime()
	end}
		
	-- Collaborator Mods
	if sanity ~= nil then
		cool = xero(loadfile(songDir..'lua/cool.lua'))
		sudo = xero(loadfile(songDir..'lua/sudo.lua'))
		cool()
		sudo()
	end

end)"
Type = "ActorFrame"
><children>

	<Layer
		Type = "Quad"
		Name = "HideEvent"
		OnCommand = "%xero(function(self)
			self:xy(scx, scy)
			self:zoomto(sw, sh)
			self:diffuse(0, 0, 0, 1)
		end)"
	/>

	<Layer Type = "ActorProxy" Name = "PC[1]" />
	<Layer Type = "ActorProxy" Name = "PC[2]" />
	<Layer Type = "ActorProxy" Name = "PJ[1]" />
	<Layer Type = "ActorProxy" Name = "PJ[2]" />
	<Layer Type = "ActorProxy" Name = "PP[1]" />
	<Layer Type = "ActorProxy" Name = "PP[2]" />

	<Layer Type = "Sprite" Name = "AFTSprite" />
	<Layer Type = "ActorFrameTexture" Name = "AFT" />

</children></Mods>
